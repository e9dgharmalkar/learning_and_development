{% extends 'tasks/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row" style="height: 100vh;">
        <!-- Sidebar -->
        <div class="col-md-2 p-1" style="background-color: rgb(240, 241, 244);">
            <h5 class="mt-3 px-2">Menu</h5>
            <div style="height: 2px; background-color: black; width: 100%; border: none;"></div>

            <h6 class="mt-3 px-2">Lists</h6>
            <ul class="list-group list-group-flush">
                {% for list in lists %}
                <li class="list-group-item p-1" style="background-color: rgb(240, 241, 244); border: none">
                    <a href="{% url 'dashboard' %}?list_id={{ list.id }}" style="text-decoration: none; color: inherit;">
                        {{ list.name }}
                    </a>
                </li>
                {% empty %}
                <li class="list-group-item p-1">No lists yet.</li>
                {% endfor %}
            </ul>

            <div class="text-start mt-2">
                <a class="btn btn-sm btn-outline-dark" href="{% url 'add_list' %}" style="border: none; box-shadow: none;">
                    <i class="bi bi-plus"></i> Add List
                </a>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-10 pt-3" style="position: relative; height: 100vh; overflow-y: auto;">
            {% if selected_task %}
                <!-- Task Detail View -->
                <h4>{{ selected_task.title }}</h4>
                <ul class="list-group">
                    {% for subtask in subtasks %}
                        <li class="list-group-item d-flex justify-content-between align-items-center" style="border: none;">
                            {{ subtask.title }}
                            <small class="text-muted">{{ subtask.deadline }}</small>
                        </li>
                    {% empty %}
                        <li class="list-group-item" style="border: none;">No subtasks for this task.</li>
                    {% endfor %}
                </ul>

                <div class="text-center py-2 mt-3"
                     style="position: absolute; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #dee2e6;">
                    <nav>
                        <ul class="pagination pagination-sm justify-content-center mb-0">
                            {% if subtasks.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?task_id={{ selected_task.id }}&page={{ subtasks.previous_page_number }}">Previous</a>
                                </li>
                            {% endif %}
                            <li class="page-item disabled">
                                <span class="page-link">Page {{ subtasks.number }} of {{ subtasks.paginator.num_pages }}</span>
                            </li>
                            {% if subtasks.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?task_id={{ selected_task.id }}&page={{ subtasks.next_page_number }}">Next</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>

            {% elif selected_list %}
                <!-- Task List View -->
                <h4>{{ selected_list.name }}</h4>
                <ul class="list-group">
                    {% for task in tasks %}
                        <li class="list-group-item d-flex justify-content-between align-items-center" style="border: none;">
                            <a href="?task_id={{ task.id }}" style="text-decoration: none; color: inherit;">
                                {{ task.title }}
                            </a>
                            <small class="text-muted">{{ task.deadline }}</small>
                        </li>
                    {% empty %}
                        <li class="list-group-item" style="border: none;">No tasks in this list.</li>
                    {% endfor %}
                </ul>

                <div class="text-center py-2 mt-3"
                     style="position: absolute; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #dee2e6;">
                    <nav>
                        <ul class="pagination pagination-sm justify-content-center mb-0">
                            {% if tasks.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?list_id={{ selected_list.id }}&page={{ tasks.previous_page_number }}">Previous</a>
                                </li>
                            {% endif %}
                            <li class="page-item disabled">
                                <span class="page-link">Page {{ tasks.number }} of {{ tasks.paginator.num_pages }}</span>
                            </li>
                            {% if tasks.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?list_id={{ selected_list.id }}&page={{ tasks.next_page_number }}">Next</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>

            {% else %}
                <p class="text-muted">Select a list to view its tasks.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
